<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management Game - No JSX Test</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/board.css">
    
    <!-- React from CDN -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- No Babel for this test -->
    
    <style>
        .server-warning {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            margin: 20px;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            display: none;
        }
    </style>
</head>
<body>
    <div style="position:fixed; top:10px; right:10px; z-index:9999; background-color:rgba(255,255,255,0.8); padding:10px; border:1px solid #ccc;">
      <button id="reset-btn">Reset Game</button>
      <button id="log-state-btn">Log State</button>
      <button id="alt-setup-btn">Show Alternate Setup</button>
    </div>
    
    <!-- Main game container -->
    <div id="game-root"></div>
    
    <!-- Alternative simple component for testing -->
    <div id="test-component-container"></div>
    
    <!-- Loading raw JS instead of JSX -->
    <script>
        // Simple CSV Parser
        function parseCSV(csvText) {
            // Split by lines
            const lines = csvText.split('\n');
            // Extract headers
            const headers = lines[0].split(',').map(h => h.trim());
            
            // Parse rows
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue; // Skip empty lines
                
                const values = lines[i].split(',').map(v => v.trim());
                const row = {};
                
                headers.forEach((header, index) => {
                    row[header] = values[index];
                });
                
                data.push(row);
            }
            
            return data;
        }

        // Game State - simplified version
        const GameState = {
            players: [],
            currentPlayerIndex: 0,
            spaces: [],
            gameStarted: false,
            gameEnded: false,
            
            // Initialize the game
            initialize(spacesData) {
                console.log('GameState.initialize called with', spacesData.length, 'spaces');
                
                this.spaces = spacesData.map(row => {
                    return {
                        id: row['Space Name'] ? row['Space Name'].replace(/\s+/g, '-').toLowerCase() : 'unknown',
                        name: row['Space Name'] || 'Unknown',
                        type: row['Phase'] || 'Unknown',
                        description: row['Event'] || '',
                        nextSpaces: [
                            row['Space 1'], 
                            row['Space 2'], 
                            row['Space 3'],
                            row['Space 4'],
                            row['Space 5']
                        ].filter(s => s && s.trim() !== '')
                    };
                });
                
                this.loadSavedState();
            },
            
            // Create a new player
            addPlayer(name, color) {
                const id = `player-${this.players.length + 1}`;
                this.players.push({
                    id,
                    name,
                    color,
                    position: this.spaces[0]?.id || 'start',
                    resources: {
                        money: 1000,
                        time: 0
                    }
                });
                this.saveState();
            },
            
            // Save state to localStorage
            saveState() {
                localStorage.setItem('game_players', JSON.stringify(this.players));
                localStorage.setItem('game_currentPlayer', this.currentPlayerIndex);
                localStorage.setItem('game_status', JSON.stringify({
                    started: this.gameStarted,
                    ended: this.gameEnded
                }));
            },
            
            // Load state from localStorage
            loadSavedState() {
                try {
                    const savedPlayers = localStorage.getItem('game_players');
                    const savedCurrentPlayer = localStorage.getItem('game_currentPlayer');
                    const savedStatus = localStorage.getItem('game_status');
                    
                    if (savedPlayers) {
                        this.players = JSON.parse(savedPlayers);
                    }
                    
                    if (savedCurrentPlayer) {
                        this.currentPlayerIndex = parseInt(savedCurrentPlayer);
                    }
                    
                    if (savedStatus) {
                        const status = JSON.parse(savedStatus);
                        this.gameStarted = status.started;
                        this.gameEnded = status.ended;
                    } else {
                        this.gameStarted = false;
                    }
                } catch (error) {
                    console.error('Error loading saved game:', error);
                    this.gameStarted = false;
                }
            },
            
            // Clear saved state
            clearSavedState() {
                localStorage.removeItem('game_players');
                localStorage.removeItem('game_currentPlayer');
                localStorage.removeItem('game_status');
            },
            
            // Start a new game
            startNewGame() {
                this.players = [];
                this.currentPlayerIndex = 0;
                this.gameStarted = false;
                this.gameEnded = false;
                this.clearSavedState();
            }
        };
        
        // Simple test component using createElement instead of JSX
        class SimpleTestComponent extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    counter: 0,
                    gameInitialized: false,
                    gameStarted: GameState.gameStarted,
                    errorMessage: null
                };
            }
            
            componentDidMount() {
                this.loadGameData();
            }
            
            async loadGameData() {
                try {
                    console.log('Loading CSV data from Spaces.csv...');
                    const response = await fetch('data/Spaces.csv');
                    const csvText = await response.text();
                    
                    console.log('CSV loaded successfully, bytes:', csvText.length);
                    const spacesData = parseCSV(csvText);
                    
                    GameState.initialize(spacesData);
                    this.setState({ 
                        gameInitialized: true,
                        gameStarted: GameState.gameStarted
                    });
                } catch (error) {
                    console.error('Error loading game data:', error);
                    this.setState({ errorMessage: error.message });
                }
            }
            
            incrementCounter = () => {
                this.setState({ counter: this.state.counter + 1 });
            }
            
            startNewGame = () => {
                GameState.addPlayer('Player 1', '#FF5733');
                GameState.addPlayer('Player 2', '#33FF57');
                GameState.gameStarted = true;
                GameState.saveState();
                this.setState({ gameStarted: true });
            }
            
            resetGame = () => {
                GameState.startNewGame();
                this.setState({ gameStarted: false });
            }
            
            render() {
                if (this.state.errorMessage) {
                    return React.createElement('div', { className: 'error-panel' },
                        React.createElement('h2', null, 'Error Loading Game'),
                        React.createElement('p', null, this.state.errorMessage),
                        React.createElement('button', { onClick: () => window.location.reload() }, 'Reload Page')
                    );
                }
                
                if (!this.state.gameInitialized) {
                    return React.createElement('div', null, 'Loading game data...');
                }
                
                if (!this.state.gameStarted) {
                    return React.createElement('div', { className: 'player-setup' },
                        React.createElement('h2', null, 'Player Setup'),
                        React.createElement('p', null, 'This is a simplified setup for testing non-JSX rendering.'),
                        React.createElement('button', { onClick: this.startNewGame }, 'Start Game with Default Players')
                    );
                }
                
                return React.createElement('div', { className: 'game-panel' },
                    React.createElement('h2', null, 'Game Running'),
                    React.createElement('p', null, 'Counter: ' + this.state.counter),
                    React.createElement('button', { onClick: this.incrementCounter }, 'Increment'),
                    React.createElement('button', { onClick: this.resetGame, style: { marginLeft: '10px' } }, 'Reset Game')
                );
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, rendering SimpleTestComponent');
            
            // Render the test component
            ReactDOM.render(
                React.createElement(SimpleTestComponent, null),
                document.getElementById('test-component-container')
            );
            
            // Set up button listeners
            document.getElementById('reset-btn').addEventListener('click', function() {
                GameState.startNewGame();
                GameState.saveState();
                window.location.reload();
            });
            
            document.getElementById('log-state-btn').addEventListener('click', function() {
                console.log('Game State:', GameState);
                console.log('Local Storage:', {
                    players: localStorage.getItem('game_players'), 
                    currentPlayer: localStorage.getItem('game_currentPlayer'), 
                    status: localStorage.getItem('game_status')
                });
            });
            
            document.getElementById('alt-setup-btn').addEventListener('click', function() {
                // This would normally show an alternate setup, but we're keeping it simple
                alert('Alternative setup would normally be shown here.');
            });
        });